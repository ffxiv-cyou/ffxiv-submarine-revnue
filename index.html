<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>潜艇收益计算器</title>
    <script type="module" crossorigin>var L=Object.defineProperty;var _=(n,e,t)=>e in n?L(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var u=(n,e,t)=>_(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();(function(){let n=/[\?&]OVERLAY_WS=([^&]+)/.exec(location.href),e=null,t=[],l=0,i={},r={},o=null,f=!1;if(n){let a=function(){e=new WebSocket(n[1]),e.addEventListener("error",s=>{console.error(s)}),e.addEventListener("open",()=>{console.log("Connected!");let s=t;t=null;for(let c of s)o(c)}),e.addEventListener("message",s=>{try{s=JSON.parse(s.data)}catch{console.error("Invalid message received: ",s);return}s.rseq!==void 0&&i[s.rseq]?(i[s.rseq](s),delete i[s.rseq]):h(s)}),e.addEventListener("close",()=>{t=[],console.log("Trying to reconnect..."),setTimeout(()=>{a()},300)})};var y=a;o=s=>{t?t.push(s):e.send(JSON.stringify(s))},a()}else{let a=function(){if(!window.OverlayPluginApi||!window.OverlayPluginApi.ready){setTimeout(a,300);return}let s=t;t=null,window.__OverlayCallback=h;for(let[c,d]of s)o(c,d)};var w=a;o=(s,c)=>{t?t.push([s,c]):OverlayPluginApi.callHandler(JSON.stringify(s),c)},a()}function h(a){if(r[a.type])for(let s of r[a.type])s(a)}window.dispatchOverlayEvent=h,window.addOverlayListener=(a,s)=>{f&&r[a]&&console.warn(`A new listener for ${a} has been registered after event transmission has already begun.
Some events might have been missed and no cached values will be transmitted.
Please register your listeners before calling startOverlayEvents().`),r[a]||(r[a]=[]),r[a].push(s)},window.removeOverlayListener=(a,s)=>{if(r[a]){let c=r[a],d=c.indexOf(s);d>-1&&c.splice(d,1)}},window.callOverlayHandler=a=>{let s;return e?(a.rseq=l++,s=new Promise(c=>{i[a.rseq]=c}),o(a)):s=new Promise(c=>{o(a,d=>{c(d==null?null:JSON.parse(d))})}),s},window.startOverlayEvents=()=>{f=!1,o({call:"subscribe",events:Object.keys(r)})}})();class P{constructor(e){u(this,"array");u(this,"capacity");u(this,"_front");u(this,"_back");u(this,"_full");this.array=[],this.capacity=e,this._front=0,this._back=0,this._full=!1}push_back(e){this.array.length<this.capacity?this.array.push(e):this.array[this._back]=e,this._back=(this._back+1)%this.capacity,this._full&&(this._front=this._back),this._back==this._front&&(this._full=!0)}front(){if(!(this._front==this._back&&!this._full))return this.array[this._front]}pop_front(){if(!(this._front==this._back&&!this._full)){var e=this.array[this._front];return this._front=(this._front+1)%this.capacity,this._full&&(this._full=!1),e}}empty(){return!this._full&&this._front===this._back}}class v{constructor(e,t,l){u(this,"id");u(this,"amount");u(this,"hq");this.id=e,this.hq=t,this.amount=l}static parse(e,t){return new v(e%1e6,e>=1e6,t)}}class I{constructor(e,t){u(this,"itemID");u(this,"amount");u(this,"date");this.itemID=e,this.amount=t,this.date=Date.now()}}class O{constructor(e){u(this,"buffer");u(this,"callback");this.buffer=new P(100),this.callback=e}parseLogLines(e){if(!(e.length<1))switch(e[0]){case"00":this.parseLogLine(e[2],e[3],e[4]);break;case"41":this.parseSystemLogMessage(e[2],e[3],e[4],e[5],e[6]);break}}parseLogLine(e,t,l){if(!(e!=="0039"&&t!=="")){var i=/接受了“(.+)”探索完成的报告。/g,r=i.exec(l);if(!(!r||r.length<1)){var o=r[1];this.queueCleanup(Date.now()),setTimeout(()=>{this.setShipName(o)},1e3)}}}parseSystemLogMessage(e,t,l,i,r){if(t==="2EF"){var o=parseInt(i,16),f=parseInt(r,16);this.enqueueItem(o,f)}}setShipName(e){for(var t=new Map;!this.buffer.empty();){var l=this.buffer.front();if(this.buffer.pop_front(),!!l){var i=l.itemID,r=l.amount;if(t.has(i)){var o=t.get(i);o!=null&&(r+=o)}t.set(i,r)}}let f=[];t.forEach((h,y)=>{var w=v.parse(y,h);f.push(w)}),this.callback(e,f)}enqueueItem(e,t){var l=new I(e,t);this.queueCleanup(l.date),this.buffer.push_back(l)}queueCleanup(e){for(;!this.buffer.empty();){var t=this.buffer.front();if(!t)break;if(e-t.date>5e3)this.buffer.pop_front();else break}}}const N=[{Id:22500,Name:"沉船戒指",PriceLow:8e3,PriceMid:3e4},{Id:22501,Name:"沉船手镯",PriceLow:9e3,PriceMid:3e4},{Id:22502,Name:"沉船耳饰",PriceLow:1e4,PriceMid:3e4},{Id:22503,Name:"沉船项链",PriceLow:13e3,PriceMid:3e4},{Id:22504,Name:"上等沉船戒指",PriceLow:27e3,PriceMid:9e4},{Id:22505,Name:"上等沉船手镯",PriceLow:28500,PriceMid:9e4},{Id:22506,Name:"上等沉船耳饰",PriceLow:3e4,PriceMid:9e4},{Id:22507,Name:"上等沉船项链",PriceLow:34500,PriceMid:9e4}];var b=new Map;N.forEach(n=>{b.set(n.Id,n)});var p=document.getElementById("item-list"),E=document.getElementById("total-value"),g=document.getElementById("app"),m=0,q=new O((n,e)=>{if(e.length!==0){var t=document.createElement("div");p.appendChild(t);var l=0;e.forEach(i=>{var r=b.get(i.id);if(r!==void 0){var o=document.createElement("div");o.innerText=r.Name+" ×"+i.amount,p.appendChild(o),l+=(i.hq?r.PriceMid:r.PriceLow)*i.amount}}),t.innerText=n+": "+l.toString(),m+=l,E.innerText=m.toString(),g.classList.remove("hide")}});document.getElementById("close").onclick=n=>{g.classList.add("hide"),p.innerText="",m=0,n.preventDefault()};addOverlayListener("LogLine",n=>{q.parseLogLines(n.line)});startOverlayEvents();</script>
    <style rel="stylesheet" crossorigin>.app{font-family:Helvetica,Segoe UI,PingFang SC,Helvetica Neue,Source Han Sans,思源黑体,Noto Sans,Microsoft Yahei,微软雅黑,Arial,sans-serif;font-size:14px;color:#fff;text-shadow:.5px .5px 2px #aa8422,-.5px .5px 2px #aa8422,.5px -.5px 2px #aa8422,-.5px -.5px 2px #aa8422;-webkit-user-select:none;user-select:none}a{text-decoration:none;color:#fff}.hide{display:none!important}.value{cursor:pointer}</style>
  </head>
  <body>
    <div class="app" id="app">
      <div><span id="ship-name">潜艇收益计算器 | 点击隐藏 </span><a href="#" id="close">&times;</a></div>
      <div>总价: <span class="value" id="total-value">0</span></div>
      <div id="item-list"></div>
    </div>
  </body>
</html>
