<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>潜艇收益计算器</title>
    <script type="module" crossorigin>
var L=Object.defineProperty;var _=(n,e,t)=>e in n?L(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var u=(n,e,t)=>(_(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();(function(){let n=/[\?&]OVERLAY_WS=([^&]+)/.exec(location.href),e=null,t=[],o=0,r={},i={},l=null,f=!1;if(n){let a=function(){e=new WebSocket(n[1]),e.addEventListener("error",s=>{console.error(s)}),e.addEventListener("open",()=>{console.log("Connected!");let s=t;t=null;for(let c of s)l(c)}),e.addEventListener("message",s=>{try{s=JSON.parse(s.data)}catch{console.error("Invalid message received: ",s);return}s.rseq!==void 0&&r[s.rseq]?(r[s.rseq](s),delete r[s.rseq]):h(s)}),e.addEventListener("close",()=>{t=[],console.log("Trying to reconnect..."),setTimeout(()=>{a()},300)})};var b=a;l=s=>{t?t.push(s):e.send(JSON.stringify(s))},a()}else{let a=function(){if(!window.OverlayPluginApi||!window.OverlayPluginApi.ready){setTimeout(a,300);return}let s=t;t=null,window.__OverlayCallback=h;for(let[c,d]of s)l(c,d)};var g=a;l=(s,c)=>{t?t.push([s,c]):OverlayPluginApi.callHandler(JSON.stringify(s),c)},a()}function h(a){if(i[a.type])for(let s of i[a.type])s(a)}window.dispatchOverlayEvent=h,window.addOverlayListener=(a,s)=>{f&&i[a]&&console.warn(`A new listener for ${a} has been registered after event transmission has already begun.
Some events might have been missed and no cached values will be transmitted.
Please register your listeners before calling startOverlayEvents().`),i[a]||(i[a]=[]),i[a].push(s)},window.removeOverlayListener=(a,s)=>{if(i[a]){let c=i[a],d=c.indexOf(s);d>-1&&c.splice(d,1)}},window.callOverlayHandler=a=>{let s;return e?(a.rseq=o++,s=new Promise(c=>{r[a.rseq]=c}),l(a)):s=new Promise(c=>{l(a,d=>{c(d==null?null:JSON.parse(d))})}),s},window.startOverlayEvents=()=>{f=!1,l({call:"subscribe",events:Object.keys(i)})}})();class P{constructor(e){u(this,"array");u(this,"capacity");u(this,"_front");u(this,"_back");u(this,"_full");this.array=[],this.capacity=e,this._front=0,this._back=0,this._full=!1}push_back(e){this.array.length<this.capacity?this.array.push(e):this.array[this._back]=e,this._back=(this._back+1)%this.capacity,this._full&&(this._front=this._back),this._back==this._front&&(this._full=!0)}front(){if(!(this._front==this._back&&!this._full))return this.array[this._front]}pop_front(){if(!(this._front==this._back&&!this._full)){var e=this.array[this._front];return this._front=(this._front+1)%this.capacity,this._full&&(this._full=!1),e}}empty(){return!this._full&&this._front===this._back}}class m{constructor(e,t,o){u(this,"id");u(this,"amount");u(this,"hq");this.id=e,this.hq=t,this.amount=o}static parse(e,t){return new m(e%1e6,e>=1e6,t)}}class I{constructor(e,t){u(this,"itemID");u(this,"amount");u(this,"date");this.itemID=e,this.amount=t,this.date=Date.now()}}class O{constructor(e){u(this,"buffer");u(this,"callback");this.buffer=new P(100),this.callback=e}parseLogLines(e){if(!(e.length<1))switch(e[0]){case"00":this.parseLogLine(e[2],e[3],e[4]);break;case"41":this.parseSystemLogMessage(e[2],e[3],e[4],e[5],e[6]);break}}parseLogLine(e,t,o){if(!(e!=="0039"&&t!=="")){var r=/接受了“(.+)”探索完成的报告。/g,i=r.exec(o);if(!(!i||i.length<1)){var l=i[1];this.queueCleanup(Date.now()),setTimeout(()=>{this.setShipName(l)},1e3)}}}parseSystemLogMessage(e,t,o,r,i){if(t==="2EF"){var l=parseInt(r,16),f=parseInt(i,16);this.enqueueItem(l,f)}}setShipName(e){for(var t=new Map;!this.buffer.empty();){var o=this.buffer.front();if(this.buffer.pop_front(),!!o){var r=o.itemID,i=o.amount;if(t.has(r)){var l=t.get(r);l!=null&&(i+=l)}t.set(r,i)}}let f=[];t.forEach((h,b)=>{var g=m.parse(b,h);f.push(g)}),this.callback(e,f)}enqueueItem(e,t){var o=new I(e,t);this.queueCleanup(o.date),this.buffer.push_back(o)}queueCleanup(e){for(;!this.buffer.empty();){var t=this.buffer.front();if(!t)break;if(e-t.date>5e3)this.buffer.pop_front();else break}}}const N=[{Id:22500,Name:"沉船戒指",PriceLow:8e3,PriceMid:3e4},{Id:22501,Name:"沉船手镯",PriceLow:9e3,PriceMid:3e4},{Id:22502,Name:"沉船耳饰",PriceLow:1e4,PriceMid:3e4},{Id:22503,Name:"沉船项链",PriceLow:13e3,PriceMid:3e4},{Id:22504,Name:"上等沉船戒指",PriceLow:27e3,PriceMid:9e4},{Id:22505,Name:"上等沉船手镯",PriceLow:28500,PriceMid:9e4},{Id:22506,Name:"上等沉船耳饰",PriceLow:3e4,PriceMid:9e4},{Id:22507,Name:"上等沉船项链",PriceLow:34500,PriceMid:9e4}];var y=new Map;N.forEach(n=>{y.set(n.Id,n)});var E=document.getElementById("ship-name"),v=document.getElementById("item-list"),p=document.getElementById("total-value"),w=document.getElementById("app"),k=new O((n,e)=>{E.innerText=n,v.innerHTML="";var t=0;e.forEach(o=>{var r=y.get(o.id);if(r!==void 0){var i=document.createElement("div");i.innerText=r.Name+" ×"+o.amount,v.appendChild(i),t+=(o.hq?r.PriceMid:r.PriceLow)*o.amount}}),p.innerText=t.toString(),w.classList.remove("hide")});document.getElementById("close").onclick=n=>{w.classList.add("hide"),n.preventDefault()};p.onclick=()=>{navigator.clipboard.writeText(p.innerText)};addOverlayListener("LogLine",n=>{k.parseLogLines(n.line)});startOverlayEvents();

</script>
    <style>
.app{font-family:Helvetica,Segoe UI,PingFang SC,Helvetica Neue,Source Han Sans,\601d\6e90\9ed1\4f53,Noto Sans,Microsoft Yahei,\5fae\8f6f\96c5\9ed1,Arial,sans-serif;font-size:14px;color:#fff;text-shadow:.5px .5px 2px #aa8422,-.5px .5px 2px #aa8422,.5px -.5px 2px #aa8422,-.5px -.5px 2px #aa8422;user-select:none}a{text-decoration:none;color:#fff}.hide{display:none!important}.value{cursor:pointer}

</style>
  </head>
  <body>
    <div class="app" id="app">
      <div><span id="ship-name">潜艇收益计算器 | 点击隐藏 </span><a href="#" id="close">&times;</a></div>
      <div>总价: <span class="value" id="total-value">0</span></div>
      <div id="item-list"></div>
    </div>
    
  </body>
</html>
